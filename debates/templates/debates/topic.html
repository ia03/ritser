{% extends "base.html" %}
{% load markdown humanize static %}

{% block title %}{% if topic.title != "" %}{{ topic.title }}{% else %}t/{{ topic.name }}{% endif %} - MoDebate{% endblock %}

{% block head %}<link rel="stylesheet" href="{% static "debates/css/topic.css" %}">
<link rel="stylesheet" href="{% static "debates/css/debateslist.css" %}">{% endblock %}

{% block body %}
    <main role="main" class="container">
      <h1 class="mt-5">{{ctopicn}}</h1>
      <p class="lead">{{topic.title}}</p>
      <a href="{% url 'topicinfo' tname=topic.name %}">Details Page</a> - <a href="{% url 'edittopic' tname=topic.name %}">Edit/View source</a> - <a href="{% url 'topicedits' tname=topic.name %}">Edits</a>
      <div class="row">
        <div class="col-md-6">Owner:
          <a href="{{topic.owner.get_absolute_url}}">
            {{topic.owner.get_username}}
          </a><br> Security Level: {{topic.slvl}}
          <br>
          Default Debate Security Level: {{topic.debslvl}}
          <br>
          Created on {{topic.created_on|date}}
          <br>
          Sorting method:
          <select onchange="changesort()" id="sorts">
            <option value="top">Top</option>
            <option value="lowest">Lowest</option>
            <option value="new">New</option>
            <option value="random">Random</option>
          </select>
        </div>
        <div class="col-md-6 text-md-right" id="modcol">
          Moderators: {% for mod in fmods|slice:":10" %}{% if not forloop.first %}, {% endif %}<a href="{{mod.get_absolute_url}}">{{mod.get_username}}</a>{% endfor %}{% if mods|length > 10 %}...{% endif %}
          <a class="btn btn-primary{% if not ats %} disabled{% endif %}" id="submitdbtn" href="{% if ats %}{% url 'submitdebate' %}?topic={{topic.name}}{% else %}#{% endif %}">Submit Debate</a>
        </div>
      </div>
      <hr />
       <br>
      {% if debates %}
      <div class="list-group" data-vote-url="{% url 'votedebate' %}">
      {% for debate in debates %}
        <div class="list-group-item list-group-item-action flex-column align-items-start container" data-debate-id="{{debate.id}}">
          <div class="row">
            <div class="col-md-1 karmad">
              {% if user.is_authenticated %}<div class="arrow-up{% if debate in dupvoted %}-selected{% endif %} votebtn"></div>{% endif %}
              <span class="karmacount" title="karma (votes)">{{debate.karma|intcomma}}</span>
              {% if user.is_authenticated %}<div class="arrow-down{% if debate in ddownvoted %}-selected{% endif %} votebtn"></div>{% endif %}
            </div>
            <div class="col-md-11">
              <div class="d-flex w-100 justify-content-between">
                <a href="{{debate.get_absolute_url}}" class="dtit"><h5 class="mb-1">{{debate.question}}</h5></a>
              </div>


              <p class="mb-1">{{debate.description|markdownf:"1"|truncatewords:50}}</p>

              <small><a href="{{debate.owner.get_absolute_url}}">{{debate.owner.get_username}}</a> - {% if topic.slvl < 1 %}<span title="{{debate.approved_on|date:"c"}}">Approved on {{debate.approved_on|date:"D d M Y f A"}}</span>{% else %}<span title="{{debate.created_on|date:"c"}}">Created on {{debate.created_on|date:"D d M Y f A"}}</span>{% endif %}{% if debate.approvalstatus == 0 %} <span class="badge badge-pill badge-success">Approved</span>{% endif %}</small>
              <div class="arglinks">
                <a href="{% url 'debateapproved' tname=topic.name did=debate.id %}" class="badge badge-primary">Approved: {{debate.numapproved}}</a>
                <a href="{% url 'debateunapproved' tname=topic.name did=debate.id %}" class="badge badge-secondary">Unapproved: {{debate.numunapproved}}</a>
                <a href="{% url 'debatedenied' tname=topic.name did=debate.id %}" class="badge badge-danger">Denied: {{debate.numdenied}}</a>
              </div>
            </div>
          </div>
        </div>
      {% endfor %}
      </div>
      {% else %}
      No debates found.
      {% endif %}
      {% if debates.has_other_pages %}
      {% load paginator %}
      {% load link_name %}
      {% paginator debates request %}
      {% endif %}
    </main>

{% endblock %}

{% block endjs %}
<script src="https://cdn.jsdelivr.net/npm/js-cookie@2.2.0/src/js.cookie.min.js"></script>
<script src="{% static "debates/js/topic.js" %}"></script>
<script src="{% static "debates/js/debatevote.js" %}"></script>{% endblock %}
