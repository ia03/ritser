{% extends "base.html" %}
{% load markdown %}

{% load humanize %}
{% load static %}

{% block title %}{% if topic.title != "" %}{{ topic.title }}{% else %}t/{{ topic.name }}{% endif %}{% endblock %}

{% block head %}<link rel="stylesheet" href="{% static "debates/css/topic.css" %}">{% endblock %}

{% block body %}
    <main role="main" class="container">
      <h1 class="mt-5">{{ctopicn}}</h1>
      <p class="lead">{{topic.title}}</p>
      <a href="{% url 'topicinfo' tname=topic.name %}">Details Page</a>
      <div class="row">
        <div class="col-md-6">Owner:
          <a href="{{topic.owner.get_absolute_url}}">
            {{topic.owner.username}}
          </a><br> Security Level: {{topic.slvl}}
          <br>
          Default Debate Security Level: {{topic.debslvl}}
          <br>
          Created on {{topic.created_on|date}}
          <br>
          Sorting method:
          <select onchange="changesort()" id="sorts">
            <option value="top">Top</option>
            <option value="lowest">Lowest</option>
            <option value="new">New</option>
            <option value="random">Random</option>
          </select>
        </div>
        <div class="col-md-6 text-md-right">Moderators: {% for mod in fmods %}{% if not forloop.first %}, {% endif %}<a href="{{mod.get_absolute_url}}">{{mod.username}}</a>{% endfor %}{% if mods|length > 10 %}...{% endif %}</div>
      </div>
      <hr />
       <br>
      {% if debates %}
      <div class="list-group" data-vote-url="{% url 'votedebate' %}">
      {% for debate in debates %}
        <div class="list-group-item list-group-item-action flex-column align-items-start container" data-debate-id="{{debate.id}}">
          <div class="row">
            <div class="col-md-1 karmad">
              {% if request.user.is_authenticated %}<div class="arrow-up{% if debate in dupvoted %}-selected{% endif %} votebtn"></div>{% endif %}
              <span class="karmacount" title="karma (votes)">{{debate.karma|intcomma}}</span>
              {% if request.user.is_authenticated %}<div class="arrow-down{% if debate in ddownvoted %}-selected{% endif %} votebtn"></div>{% endif %}
            </div>
            <div class="col-md-11">
              <div class="d-flex w-100 justify-content-between">
                <a href="{{debate.get_absolute_url}}" class="dtit"><h5 class="mb-1">{{debate.question}}</h5></a>
              </div>


              <p class="mb-1">{{debate.description|markdownf:"1"|truncatewords:50}}</p>

              <small><a href="{{debate.owner.get_absolute_url}}">{{debate.owner.username}}</a> - <span title="{{debate.approved_on|date:"c"}}">{{debate.approved_on|date:"D d M Y f A"}}</span>{% if debate.approvedstatus == 0 %} <span class="badge badge-pill badge-success">Approved</span>{% endif %}</small>
              <div class="arglinks">
                <a href="{% url 'debateapproved' tname=topic.name did=debate.id %}" class="badge badge-primary">Approved</a>
                <a href="{% url 'debateunapproved' tname=topic.name did=debate.id %}" class="badge badge-secondary">Unapproved</a>
                <a href="{% url 'debatedenied' tname=topic.name did=debate.id %}" class="badge badge-danger">Denied</a>
              </div>
            </div>
          </div>
        </div>
      {% endfor %}
      </div>
      {% else %}
      No debates found.
      {% endif %}
      {% if debates.has_other_pages %}
      {% load proper_paginate %}
      {% load link_name %}
      <nav aria-label="Page navigation">
        <ul class="pagination">
          {% if page_obj.number == 1 %}
          <li class="page-item disabled"><span>⇤</span></li>
          {% else %}
          <li class="page-item"><a class="page-link" href="{{request.get_full_path|link_name:1}}{{sorta}}">⇤</a></li>
          {% endif %}
          {% if not debates.has_previous %}
          <li class="page-item disabled">
            <a class="page-link" href="#" tabindex="-1">&laquo;</a>
          </li>
          {% else %}
          <li class="page-item">
            <a class="page-link" href="{{request.get_full_path|link_name:debates.previous_page_number}}{{sorta}}" tabindex="-1">&laquo;</a>
          </li>
          {% endif %}
          {% for p in debates.paginator|proper_paginate:debates.number %}
          {% if debates.number == p %}
          <li class="page-item active">
            <a class="page-link" href="{{request.get_full_path|link_name:p}}{{sorta}}">{{p}} <span class="sr-only">(current)</span></a>
          </li>
          {% else %}
          <li class="page-item"><a class="page-link" href="{{request.get_full_path|link_name:p}}{{sorta}}">{{p}}</a></li>
          {% endif %}
          {% endfor %}
          {% if not debates.has_next %}
          <li class="page-item disabled">
            <span class="page-link">&raquo;</span>
          </li>
          {% else %}
          <li class="page-item">
            <a class="page-link" href="{{request.get_full_path|link_name:debates.next_page_number}}{{sorta}}">&raquo;</a>
          </li>
          {% endif %}
          {% if debates.number == debates.paginator.num_pages %}
          <li class="page-item disabled"><a class="page-link" href="{{ request.get_full_path|link_name:debates.paginator.num_pages }}">⇥</a></li>
          {% else %}
          <li class="page-item"><a class="page-link" href="{{ request.get_full_path|link_name:debates.paginator.num_pages }}">⇥</a></li>
          {% endif %}
        </ul>
      </nav>
      {% endif %}
    </main>

{% endblock %}

{% block endjs %}
<script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js" integrity="sha384-xfK7Pd4lZwvHpwqHVm6CLkaaJWD3pwmicCjngjDHNBjH5tYAr4ZsgFBEbtnjI1zD" crossorigin="anonymous"></script>
<script type="text/javascript" src="{% static "debates/js/topic.js" %}"></script>{% endblock %}
